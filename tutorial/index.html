
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Tutorial &#8212; Chips 2.2.1 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <link rel="shortcut icon" href="../_static/chips.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Examples" href="../examples/index.html" />
    <link rel="prev" title="c2verilog" href="../user_manual/c2verilog.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../examples/index.html" title="Examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../user_manual/c2verilog.html" title="c2verilog"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Chips 2.2.1 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="create-and-test-a-c-component">
<h2>Create and Test a C component<a class="headerlink" href="#create-and-test-a-c-component" title="Permalink to this headline">¶</a></h2>
<p>Why not start with a simple example. With your favourite text editor, create a
file count.c and add the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">count</span><span class="p">(){</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
                <span class="n">report</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can convert C components into Verilog components using the C2Verilog
compiler. The <em>iverilog</em> option causes the generated Verilog component to be
compiled using Icarus Verilog. The <em>run</em> option causes simulation to be run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>~$ c2verilog iverilog run test.c
1
2
3
4
5
6
7
8
9
10
</pre></div>
</div>
<p>When a design is reset, execution starts with the last function defined in
the C file. This need not be called <em>main</em>. The name of the last function
will be used as the name for the generated Verilog component. The C program will
appear to execute in sequence, although the compiler may execute instructions
concurrently if it does not affect the outcome of the program. This will allow
your component to take advantage of the inherent parallelism present in a hardware
design.</p>
<p>The <em>report</em> function is a <em>built-in</em> function which is helpful for debug, it
will print the value of a variable on the console during simulations, when you
synthesise the design it will be ignored.</p>
<p>This component doesn’t have any inputs or outputs, so it isn’t going to be very
useful in a real design. You can add inputs and outputs to a components using
function calls with special names. Functions that start with the name <em>input_</em>
or <em>output_</em> are interpreted as inputs, or outputs respectively.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">temp</span><span class="p">;</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">input_spam</span><span class="p">();</span> <span class="o">//</span><span class="n">reads</span> <span class="kn">from</span> <span class="nn">an</span> <span class="nb">input</span> <span class="n">called</span> <span class="n">spam</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">input_eggs</span><span class="p">();</span> <span class="o">//</span><span class="n">reads</span> <span class="kn">from</span> <span class="nn">an</span> <span class="nb">input</span> <span class="n">called</span> <span class="n">eggs</span>
<span class="n">output_fish</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>   <span class="o">//</span><span class="n">writes</span> <span class="n">to</span> <span class="n">an</span> <span class="n">output</span> <span class="n">called</span> <span class="n">fish</span>
</pre></div>
</div>
<p>Reading or writing from inputs and outputs causes program execution to block
until data is available. This synchronises data transfers with other components
executing in the same device, this method of passing data between concurrent
processes is much simpler than the mutex/lock/semaphore mechanisms used in
multithreaded applications.</p>
<p>If you don’t want to commit yourself to reading and input and blocking
execution, you can check if data is ready:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">temp</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="n">ready_spam</span><span class="p">()){</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">input_spam</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>There is no equivalent function to check if an output is ready to receive data,
this could cause deadlocks if both the sending and receiving end were waiting
for one another.</p>
<p>We can now construct some basic hardware components quite simply. Here’s a counter for instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">counter</span><span class="p">(){</span>
        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
                <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
                        <span class="n">output_out</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can generate an adder like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">added</span><span class="p">(){</span>
        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
                <span class="n">output_z</span><span class="p">(</span><span class="n">input_a</span><span class="p">()</span><span class="o">+</span><span class="n">input_b</span><span class="p">());</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Or a divider like this (yes, you can synthesise division):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">divider</span><span class="p">(){</span>
        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
                <span class="n">output_z</span><span class="p">(</span><span class="n">input_a</span><span class="p">()</span><span class="o">/</span><span class="n">input_b</span><span class="p">());</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can split a stream of data into two identical data streams using a tee function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">tee</span><span class="p">(){</span>
        <span class="nb">int</span> <span class="n">temp</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">input_a</span><span class="p">();</span>
                <span class="n">output_y</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
                <span class="n">output_z</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If we want to merge two streams of data, we could interlace them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">interlace</span><span class="p">(){</span>
        <span class="nb">int</span> <span class="n">temp</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">input_a</span><span class="p">();</span>
                <span class="n">output_z</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">input_b</span><span class="p">();</span>
                <span class="n">output_z</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>or we could prioritise one stream over the other:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">arbiter</span><span class="p">(){</span>
        <span class="nb">int</span> <span class="n">temp</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span> <span class="n">ready_a</span><span class="p">()</span> <span class="p">){</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="n">input_a</span><span class="p">();</span>
                        <span class="n">output_z</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">ready_b</span><span class="p">()</span> <span class="p">){</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="n">input_b</span><span class="p">();</span>
                        <span class="n">output_z</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
                <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/chips.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#create-and-test-a-c-component">Create and Test a C component</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../user_manual/c2verilog.html"
                        title="previous chapter">c2verilog</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../examples/index.html"
                        title="next chapter">Examples</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tutorial/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../examples/index.html" title="Examples"
             >next</a> |</li>
        <li class="right" >
          <a href="../user_manual/c2verilog.html" title="c2verilog"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Chips 2.2.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, Jonathan P Dawson.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>